
//??????????

#include <stdio.h>
#include <stdlib.h>
#pragma once
#pragma warning(disable:4996)

#define OK 1
//**************************************************************************
typedef struct students {
	int ID;
	char name[16];
	char sex;
	char birthday[8];
	char nation[4];
	double score;
}Students;

typedef struct LNode
{
	int ID;
	int subscript;
	struct LNode   *next;
} LNode;

typedef struct Node {
	struct LNode *elem;
	int count;
}HashTable;

HashTable ChainHash[5];
Students STU[] = {
	{ 1001 , "???", 'm', "19970211", "????", 69 },
{ 1002 , "???", 'm', "19980523", "????", 38 },
{ 1003 , "????", 'f', "19970614", "????", 91 },
{ 1004 , "????", 'm', "19980425", "????", 73 },
{ 1005 , "????", 'm', "19970815", "????", 89 },
{ 1006 , "????", 'f', "19980918", "????", 76 },
{ 1007 , "???", 'm', "19971001", "????", 90 },
{ 1008 , "????", 'm', "19971224", "????", 89 },
{ 1009 , "???", 'f', "19980519", "????", 55 },
{ 1010 , "???", 'f', "19970603", "????", 88 },
{ 1011 , "????", 'f', "19970703", "????", 98 }
};

//**********************************************************************

int Add(int m) {
	//???????????????
	int i;//??????????
	int length, length1;//??????
	
	length = sizeof(STU) / sizeof(STU[0]); printf("length=:%d  \n", length);

	printf("????????????????????????(16?)?????(m??f)??????????(8?)??????(4?)???????:\n");
	for (i = length; i < length + m; i++) {

		scanf("%d%s%c%s%s%lf", &STU[i].ID, STU[i].name, &STU[i].sex, STU[i].birthday, STU[i].nation,&STU[i].score);
		printf("%d  %s  %c  %s  %s  %.2lf\n", STU[i].ID, STU[i].name, STU[i].sex, STU[i].birthday, STU[i].nation, STU[i].score);
	}//for
	length1 = sizeof(STU) / sizeof(STU[0]);
	printf("length1=:%d  \n", length1);
	return OK;
}//Add

int Hash() {
	int i, j;//??????????
	int m;//ChainHash??????±?
	LNode *p;
	LNode *q;
	int length1;

	for (i = 0; i < 5; i++) {
		ChainHash[i].elem = NULL;
		ChainHash[i].count = 0;
	}
	int length;//????????????
	length = sizeof(STU) / sizeof(STU[0]);
	printf("????????????:  \n");
	for (j = 0; j < length; j++) {
		m = STU[j].ID % 5;
		q = (LNode*)malloc(sizeof(LNode));	
		if (!ChainHash[m].count) {
			ChainHash[m].elem = q;
			q->ID = STU[j].ID;
			q->subscript = j; 
			printf("    %d  %d \n", q->ID, q->subscript);
		}
		else
		{
			for (p = ChainHash[m].elem; p->next; p = p->next);
			q->ID = STU[j].ID;
			q->subscript = j;
			p->next = q; 
			printf("    %d  %d \n", q->ID, q->subscript);
		}
		q->next = NULL;
		ChainHash[m].count++;
	}
	length1 = sizeof(STU) / sizeof(STU[0]);
	printf("length2=:%d  \n", length1);

	return OK;
}//Hash

int SearchHash(int key) {
	int m;//ChainHash??????±?
	int flag=0;//?????û???????????
	LNode *p;

	m = key % 5;
	if (!ChainHash[m].count) {
		printf("???????????!\n");
		return OK;
	}

	for (p = ChainHash[m].elem; p; ) {
		if (p->ID == key) {
			printf("??????????:%.2lf\n", STU[p->subscript].score);
			flag = 1;
		}printf("    %d  %d \n", p->ID, p->subscript);
		p = p->next;
	}

	if (!flag) {
		printf("???????????!!\n");
	}

	return OK;
}//SearchHash

int Statistic(int m, int n) {
	//??????????????
	int i;//??????????
	int count = 0;//????
	int length;//????????????
	length = sizeof(STU) / sizeof(STU[0]);

	for (i = 0; i < length; i++){
		if (STU[i].score > m && STU[i].score < n)
			count += 1;
	}
	printf("    %d\n", count);

	return OK;
}//Statistic

int Sorting() {
	int i, j, k, l;//??????????
	double swap;//????????????
	int length;//????????????
	length = sizeof(STU) / sizeof(STU[0]);
	double a[100];//??????????

	for (i = 0; i < length; i++) {
		a[i] = STU[i].score;
	}

	for (j = 0; j < length; j++) {
		for (k = j + 1; k < length; k++) {
			if (a[k] > a[j]) {
				swap = a[k];
				a[k] = a[j];
				a[j] = swap;
			}
		}
	}
	for (l = 0; l < length; l++) {
		printf("%.2lf  ", a[l]);
	}
	return OK;
}//Sorting

int main() {
	int m;//????????????
	int YN;//?????????????
	int key;//?????????

	printf("????????µ??????(??1??0):  ");
	scanf("%d", &YN);
	if (YN) {
		printf("???????????????:  ");
		scanf("%d", &m);
		Add(m);
	}

	Hash();
	printf("????????????????????:  "); getchar();
	scanf("%d", &key); 
	SearchHash(key);

	printf("?????????????:\n");
	printf("       <60:"); Statistic(0, 60);
	printf("     60~70:"); Statistic(60, 70);
	printf("     70~80:"); Statistic(70, 80);
	printf("    80~100:"); Statistic(80, 100);

	printf("??????????????:\n");
	Sorting(STU);
	system("pause");

	return OK;
}
